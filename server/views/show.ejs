<!doctype html>
<html>
<head>
  <%- include('head'); %>
</head>
<body>

<%- include('nav'); %>

<main role="main" class="container">

  <div class="row my-3">

    <% if(model.is_complete){ %>
      <button id="sampleBtn" type="button" class="btn btn-primary" onclick="generateSample()">Generate sample</button>
    <% } %>

    <% if(!model.has_data){ %>
      <a class="btn btn-outline-primary" href="/model/<%= model.id %>/upload">Upload training data</a>
    <% } %>

    <% if(model.is_in_progress){ %>
      <form action="/model/<%=model.id%>/stop" method="post">
        <button type="submit" class="btn btn-danger">Stop training</button>
      </form>
    <% } %>

  </div>

  <div class="row mt-3">

    <div class="col-sm-4">
      <h1 class="mb-3">Model</h1>
      <dl class="mb-3">
        <dt>ID</dt>
        <dd><%= model.id %></dd>
        <dt>Created at</dt>
        <dd><%= model.created_at %></dd>
        <dt>Updated at</dt>
        <dd><%= model.updated_at %></dd>
        <dt>Has training data</dt>
        <dd><%= model.has_data %></dd>
        <dt>Training in progress</dt>
        <dd><%= model.is_in_progress %></dd>
        <dt>Contains trained model</dt>
        <dd><%= model.is_complete %></dd>
      </dl>

    </div>
    <div class="col-sm-4">
      <h2 class="mb-3">Training log</h2>
      <% if(model.is_complete || model.is_in_progress){ %>
        <pre class="bg-dark text-light p-3"><%= locals.log %></pre>
      <% } %>
    </div>
    <div class="col-sm-4">
      <h2 class="mb-3">Generated sample</h2>
      <div id="sample" class="bg-dark text-light p-3 my-3" style="display: none"></div>
    </div>

  </div>

</main>

<script>
  function generateSample() {
    $("#sample").empty()
    $("#sample").show()

    $("#sampleBtn").prop("disabled", true)

    $.get("/model/<%= model.id %>/sample")
      .done(function (data) {
        $("#sample").text(data)
      })
      .fail(function (data) {
        $("#sample").text(data || "Error occurred")
      })
      .always(function () {
        $("#sampleBtn").prop("disabled", false)
      })
  }
</script>

</body>
</html>
